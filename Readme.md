<p align="center" style="font-size: x-large;">Askew</p>

<h2 align="center">A code generator for building single-page web applications with GopherJS</h2>

Askew is a tool for writing re-usable HTML components.
Each component is a HTML fragment enriched with annotations.
Askew reads those components and generates a Go type for each one.
Those Go types can then be used to create single-page web applications via GopherJS.

Askew does not contain a single line of JavaScript, nor does it depend on any JavaScript libraries.
Of course, the generated code is eventually compiled to JavaScript.

### Overview

<img src="./pipeline.svg">

You define your components inside one or more files containing annotated HTML.
Annotated HTML consists of standard HTML structure and additional elements and attributes whose name starts with `a:`.
These annotations are processed by Askew.

Askew works similarly to `go build`:
You execute it on a directory and it processes all files with the `.askew` extension which are located within that directory.
Each file `name.askew` will generate a file `name.go` in the same directory.
Askew requires a `go.mod` file in the working directory or one of its ancestors.
This is used for generating and resolving import paths.

Askew expects a file `skeleton.html` in its working directory.
This file must contain the static HTML structure of the page.
Usually, it embeds one or more dynamic components defined in the `.askew` files.
It must contain one `<a:templates>` which will be replaced by `<template>` elements used to generate each component.
It also should load the JavaScript file `main.js` that is generated by GopherJS.
Askew processes this file and writes the result into `index.html` and `init.go`; the latter initializes all embedded components in the skeleton.

You then write your Go code using the components (e.g. implementing event handlers or modifying bound values) and finally compile it together with the generated code with GopherJS.
This yields a file `main.js`.
After this is done, you can run your website by opening `index.html`, which loads the `main.js` script containing your compiled Go code.

### Example

Let's define a component as well as the skeleton of our website in annotated HTML:

```html
<!-- ui/components.askew -->
<a:component name="Greeter">
  <!-- defines a handler for the component. Handlers translate to Go methods.
        A handler may have parameters, which will be mapped to DOM items when
        calling it. -->
  <a:handler>Greet(name string)</a:handler>
  <!-- a:capture binds DOM events to defined handlers.
        form(Name) binds to the form's value with the given name. -->
  <form a:capture="submit:Greet(name=form(Name))">
    <label for="Name">What's your name?</label>
    <!-- a:bindings binds items in the DOM to Go accessors.
          in this case, we get a bool accessor that switches
          the class "hasError" on or off on this element. -->
    <p a:bindings="class(hasError):HasError">
      <!-- with prop(), we can bind to a certain property of a DOM node.
           in this case, prop(value) is equivalent to form(Name). -->
      <input name="Name" a:bindings="prop(value):Name">
      <span a:bindings="prop(textContent):ErrorMsg"></span>
    </p>
    <button type="submit">Greet</button>
  </form>
</a:component>
```

```html
<!-- skeleton.html -->
<!doctype html>
<html lang="en">
<head>
  <title>Example</title>
  <style>
    .hasError {
      background-color: #f66;
    }
  </style>
  <!-- we need to import packages just like in Go. -->
  <a:import>"mymodule/ui"</a:import>
</head>
<body>
  <h1>Askew Greeter Example</h1>
  <!-- embed our component here and give the instance the name `Form`. -->
  <a:embed name="Form" type="ui.Greeter"></a:embed>
  <!-- Askew will inject the templates for the components here -->
  <a:templates></a:templates>
  <!-- load the generated JavaScript code -->
  <script src="main.js"></script>
</body>
</html>
```

To generate code, we execute askew in our module's directory:

    mkdir -p site
    askew -o site

This tells askew to place the generated `index.html` in the directory `site`.
The generated Go files are always placed in the same directory as their corresponding `.askew` files.
We now generated the following files:

    go.mod
    init.go            <--
    site/
      index.html       <--
    skeleton.html
    ui/
      components.go    <--
      components.askew

Now we need to implement the handler we defined (Askew generates code that calls it, but doesn't implement it).
Put this in `ui/greetercontrol.go`:

```go
package ui

import "github.com/gopherjs/gopherjs/js"

func (o *Greeter) Greet(name string) bool {
  switch name {
    case "":
      o.HasError.Set(true)
      o.ErrorMsg.Set("please tell me your name")
    case "petaQ":
      o.HasError.Set(true)
      o.ErrorMsg.Set("I'm not calling you that")
    default:
      o.HasError.Set(false)
      o.ErrorMsg.Set("")
      js.Global.Call("alert", "Hello, " + name + "!")
  }
  // return true to prevent the captured event's default action
  return true
}
```

Finally, we need to have a `main.go` in the module root:

```go
package main

func main() {
  // set default name
  Form.Name.Set("World")
}
```

Compile it with GopherJS:

    gopherjs build -o site/main.js

Now open `site/index.html` to run your single-page application!

### Syntax Documentation

TBD

### License

MIT